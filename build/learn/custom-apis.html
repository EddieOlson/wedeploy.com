<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Launchpad Project (Beta)</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link rel="shortcut icon" href="/images/favicon.ico">

	<!-- Fonts -->
	<script src="https://use.typekit.net/kkw4zdf.js"></script>
	<script>try{Typekit.load({ async: true });}catch(e){}</script>
	<link rel="stylesheet" href="/vendor/fonts/icon-12.css">
	<link rel="stylesheet" href="/vendor/fonts/icon-16.css">
	<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:700,400,300">

	<!-- Styles -->
	<link rel="stylesheet" href="/styles/all.css">
	
	<link rel="stylesheet" href="/styles/learn.css">
	<link rel="stylesheet" href="/vendor/styles/github.css">

</head>
<body class="fade-out">

	
	<nav class="topbar topbar-inverse">
		<div class="topbar-logo">
			<a class="topbar-logo-link" href="/">
				<span class="icon-16-launchpad-logo"></span>
				<span class="topbar-logo-text">Launchpad <span class="topbar-logo-complementary">Project <span class="topbar-logo-label">Beta</span></span></span>
			</a>
		</div>
		<ul class="topbar-list">
			<li class="topbar-item">
				<a class="topbar-link" href="/">Product</a>
			</li>
			<li class="topbar-item">
				<a class="topbar-link topbar-link-selected" href="/learn">Learn</a>
			</li>
			<li class="topbar-item">
				<a class="topbar-link" href="/dashboard/login/signin">Login</a>
			</li>
		</ul>
	</nav>

	<main class="docs">
		<div class="container">
			<div class="row">
				<nav class="docs-nav col-xs-12 col-sm-3">
					<p class="docs-nav-group">What is?</p>
					<ul class="docs-nav-list">
						<li class="docs-nav-item">
							<a href="/learn" class="docs-nav-link">Frequently Asked Questions</a>
						</li>
					</ul>

					<p class="docs-nav-group">How to use?</p>
					<ul class="docs-nav-list">
						<li class="docs-nav-item">
							<a href="/learn/authentication.html" class="docs-nav-link">Authentication</a>
						</li>
						<li class="docs-nav-item">
							<a href="/learn/realtime-database.html" class="docs-nav-link">Realtime Database</a>
						</li>
						<li class="docs-nav-item">
							<a href="/learn/custom-apis.html" class="docs-nav-link">Custom APIs</a>
						</li>
					</ul>

					<p class="docs-nav-group">How it works?</p>
					<ul class="docs-nav-list">
						<li class="docs-nav-item">
							<a href="/learn/data-operations.html" class="docs-nav-link">Data Operations</a>
						</li>
					</ul>
				</nav>

				<article class="docs-content col-xs-12 col-sm-6 col-sm-offset-1">
					<h1 id="custom-apis">Custom APIs</h1>
<h3 id="1-understand-api-json">1. Understand api.json</h3>
<p>Launchpad enables you to create apps, and each app is composed by one or more services. A service is exposed with a REST interface that you can configure in the <code>api.json</code> file. A service api consists of a list of apis, each following the format:</p>
<pre><code class="lang-json">{
  &quot;path&quot;: null,
  &quot;method&quot;: [&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;PATCH&quot;, &quot;DELETE&quot;],
  &quot;handler&quot;: null,
  &quot;title&quot;: null,
  &quot;description&quot;: null,
  &quot;auth&quot;: null,
  &quot;parameters&quot;: null,
  &quot;body&quot;: null,
  &quot;visibility&quot;: true,
  &quot;blocking&quot;: true
}
</code></pre>
<p>These are the default values for an api. The service will use this list of api definitions to create a router for your service, and then each request that matches your service path will be handled by this router. Thus, it&#39;s important to notice that the order in which these apis are described in your <code>api.json</code> is the same order your service will try to match and process your request. So, for example, if you define one api to describe your authorization logic for a path, and another to define a function to handle the request, you need to put them in the proper order inside the file.</p>
<h4 id="path">Path</h4>
<p>The <code>path</code> is used by your service router to define which requests will be affected by this api definition. The base url for an service named <code>myService</code> in an app called <code>myApp</code> is:</p>
<pre><code>liferay.io/myApp/myService
</code></pre><p>Your path then only need to specify the url section that comes after this base url in a incoming request. You can specify fixed paths like:</p>
<pre><code>/my/api/route
</code></pre><p>Or patterns to match the request url:</p>
<pre><code>/sum/:first(\\d+)/:second(\\d+)
</code></pre><p>This patterns enables you to create a RegEx pattern to filter the urls, and also name the extracted url segment for future reference. The example above will match any request with two numbers after <code>sum</code>, like <code>/sum/123/456</code>, but not requests like <code>/sum/text</code> or <code>/sum/123/word</code>. You can also match only the prefix of the request, using the wildcard:</p>
<pre><code>/api/prefix/*
</code></pre><p>This will match paths like <code>/api/prefix</code>, <code>/api/prefix/path</code>, and so on...</p>
<p>Notice the path from two different apis may overlap, or even be identical. In this case, your service will match the first api, in the order they&#39;re described in your <code>api.json</code>, and if this one doesn&#39;t handle the request or explicitly calls <code>next</code> inside the handler, then it will match and execute the second one.</p>
<p>You can also mount data in your path using the token <code>@</code>:</p>
<pre><code>/my/base/path/@/users/*
</code></pre><p>This example will mount the collection <code>users</code> after the path <code>/my/base/path</code>, so requests like:</p>
<pre><code>/my/base/path/users/1/name
</code></pre><p>Will access the name of the user with ID <code>1</code>. For more information on mounting data paths, see <a href="https://github.com/liferay-apps/landing/wiki/Data-Operations">Data Operations</a>.</p>
<p>Once you&#39;ve mapped all your paths, you can access it by merging the path with your service base url:</p>
<pre><code class="lang-bash">curl &quot;http://liferay.io/myApp/myService/my/mapped/path&quot;
</code></pre>
<h4 id="method">Method</h4>
<p>The <code>method</code> works as a filter for requests that will be routed to this api definition. By default, all HTTP requests are mapped to an api, but you can change it to any subset you need.</p>
<h4 id="handler">Handler</h4>
<p>The <code>handler</code> is where you can point to a function to receive the request and process it. It can be in <a href="#custom_apis_create_java_service"> Java </a> or href=&quot;#custom_apis_create_javascript_service&quot;&gt; Javascript </a>.</p>
<p>Javascript</p>
<pre><code class="lang-json">{
  &quot;path&quot;: &quot;/hello&quot;,
  &quot;method&quot;: &quot;GET&quot;,
  &quot;handler&quot;: &quot;api.js#handler&quot;
}
</code></pre>
<p>Java</p>
<pre><code class="lang-java">{
  &quot;path&quot;: &quot;hello&quot;,
  &quot;method&quot;: &quot;GET&quot;,
  &quot;handler&quot;: &quot;foo.Bar#handler&quot;
}
</code></pre>
<p>The router will not continue to match the request with your service&#39;s apis after it encounters a handler or a data path, so its up to you finishing the response in your code:</p>
<pre><code class="lang-js">function handler(request, response) {
   // process request
   response.end(&#39;Hello Launchpad World!&#39;);
}
</code></pre>
<p>Java</p>
<pre><code class="lang-java">public void handler(Request request, Response response) {
   // process request
   response.end(&quot;Hello Launchpad World!&quot;);
}
</code></pre>
<p>Or just return the string to be used as body in a <code>200 OK</code> response:</p>
<p>Javascript</p>
<pre><code class="lang-js">function handler() {
   return &#39;Hello Launchpad World!&#39;;
}
</code></pre>
<p>Java</p>
<pre><code class="lang-java">public String handler() {
   return &quot;Hello Launchpad World!&quot;;
}
</code></pre>
<p>Nonetheless, if you want to process the request and delegate it to the next routes, you can call explicitly <code>request.next()</code> inside your code and make the router continue the iteration over your <code>api.json</code>.</p>
<pre><code class="lang-js">function handler(Request request) {
   // process request
   request.next();
}
</code></pre>
<p>Java</p>
<pre><code class="lang-java">public void handler(Request request) {
   // process request
   request.next();
}
</code></pre>
<h4 id="title-and-description">Title and Description</h4>
<p>The <code>title</code> and <code>description</code> are optional information that can be used as documentation for your api. In you <code>api.json</code>, just fill with string values:</p>
<pre><code class="lang-json">{
   &quot;path&quot;: &quot;@/users&quot;,
   &quot;title&quot;: &quot;User collection&quot;,
   &quot;description&quot;: &quot;Service&#39;s user collection, that can be used to save and access user information.&quot;
}
</code></pre>
<h4 id="auth">Auth</h4>
<p>The <code>auth</code> is an object that describes all criteria an authenticated user needs to meet in order to have access this path. If the authorization of the request fails, the service may redirect the request to a registered login page (see <a href="#authentication_configuration"> Authentication Configuration </a> to know how to setup a login page for your app), or respond with <code>404 Not Found</code> to avoid giving the unauthorized user any information about your service.</p>
<p>This auth object has the following fields:</p>
<pre><code class="lang-json">{
  &quot;auth&quot;: {
    &quot;permissions&quot;: [&quot;permission1&quot;, &quot;permission2&quot;],
    &quot;roles&quot;: [&quot;role1&quot;, &quot;role2&quot;],
    &quot;validator&quot;: &quot;$auth.id === 123&quot;
  }
}
</code></pre>
<p>The <code>permissions</code> field list all permissions a user must have to be authorized. This permissions can be resolved from the user permissions, or from any role he may have that has this permission (see <a href="#authentication_configuration"> Authentication Configuration </a> to know how to define the roles&#39; permissions for your app).</p>
<p>The <code>roles</code> field list all roles a user must have to be authorized. Note that even if the user has all permissions that defined a role in your app, he will not be granted access to this api if he doesn&#39;t have the role itself. For example, if you configured your app so the role <code>admin</code> has permissions <code>[&quot;read&quot;, &quot;write&quot;]</code>, a user will not access you api without the role <code>admin</code> even if he has both permissions separately.</p>
<p>The <code>validator</code> field enables you to describe any javascript expression to authorize the request. You can access any request data available in the scripting environment (see more about this bellow with api parameters).</p>
<h4 id="parameters">Parameters</h4>
<p>The <code>parameters</code> can be used to describe any parameter a request may receive. We will load these parameters from:</p>
<ul>
<li>url query</li>
<li>form url encoded</li>
<li>multipart form</li>
<li>json body</li>
</ul>
<p>So, the following request:</p>
<pre><code class="lang-bash">curl -X &quot;POST&quot; &quot;http://liferay.io/app/service/hello?foo=bar&quot; \
  --data-urlencode &quot;key=1&quot;
</code></pre>
<p>Have the parameters <code>foo</code> and <code>key</code> with values <code>&quot;bar&quot;</code> and <code>1</code>, respectivelly. Also does the requests:</p>
<pre><code class="lang-bash">curl -X &quot;POST&quot; &quot;http://liferay.io/app/service/hello?foo=bar&quot; \
  --header &quot;Content-Type: application/json&quot; \
  --data &quot;{\&quot;key\&quot;:1}&quot;
</code></pre>
<pre><code class="lang-bash">curl -X &quot;GET&quot; &quot;http://liferay.io/app/service/hello?foo=bar&amp;key=1&quot;
</code></pre>
<p>In parameters you can specify:</p>
<pre><code class="lang-json">{
  &quot;parameters&quot;: {
    &quot;parameterName&quot; : {
      &quot;description&quot;: &quot;Some description here.&quot;,
      &quot;required&quot;: false,
      &quot;type&quot;: &quot;number&quot;,
      &quot;validator&quot;: &quot;$params.parameterName &gt; 0&quot;,
      &quot;value&quot;: null
    }
  }
}
</code></pre>
<p>The supported <code>type</code> values are the JSON types: string, number, boolean, array and object. The <code>required</code> flag indicates the parameter must be present in the request. The validator is a expression in javascript that will be executed if a value is passed for this parameter, and it must return <code>true</code> for the request to be accepted. The <code>value</code> can be set to define a value that will be injected in the received request (note that this is not a <em>default</em> value, this value will always be injected and will be accumulated to existing values in the request). If a request fails to comply to any of this specifications, a <code>400 Bad Request</code> will be returned with all errors for all parameters.</p>
<p>The validator script will be executed in an environment were several request and server data will be available. These global variables can be used as the user needs to validate the request parameter, body or even to authorize the request. The variables are:</p>
<ul>
<li><code>$auth</code>: the authenticated user of this request. If the request was not authenticated, it will be <code>null</code>.</li>
<li><code>$config</code>: the raw JSON data stored in the service&#39;s <code>config.json</code> file.</li>
<li><code>$session</code>: all stored session data. If the request had no session cookie, it will be an empty map for the new session created for this request.</li>
<li><code>$params</code>: the request params as they were loaded from url query and request body. All query and form parameters will be strings here.</li>
<li><code>$values</code>: the parsed request params, as they are used for parameter validation. All query and form parameters will be parsed to JSON values.</li>
<li><code>$body</code>: the parsed request body.</li>
<li><code>$data</code>: the data view for this request, if a data path is mounted in the api path and the request path represents a key to access any data resource (collection, document or inner field from a document). It will be <code>null</code> otherwise.</li>
</ul>
<h4 id="body">Body</h4>
<p>The <code>body</code> is a descriptor similar to a parameter descriptor, with the exception of the <code>value</code> field, and it can be used to describe and validate the request body. This can be usefull when the body will not be a form url encoded, multipart form or a JSON object, making it impossible to validate it with the <code>parameters</code> field. One example is to validate body data in a api like:</p>
<pre><code class="lang-json">{
  &quot;body&quot;: {
    &quot;description&quot;: &quot;Prefixed body.&quot;,
    &quot;type&quot;: &quot;string&quot;,
    &quot;required&quot;: false,
    &quot;validator&quot;: &quot;$body.startsWith($config.bodyPrefix)&quot;
  }
}
</code></pre>
<h4 id="visibility">Visibility</h4>
<p>You can specify the visibility of your service at the api level. If you want to map a path that only internal services inside your app will be able to reach, you can set this flag to <code>false</code> in your api definition. By default its set to <code>true</code>.</p>
<h4 id="blocking">Blocking</h4>
<p>You can specify the kind of process your handler will execute in your api definition. If you will execute a code too complex, or perform any blocking IO request or function, its better to set the <code>blocking</code> flag to <code>true</code>, so the server will allocate a special part of the resources to process this request and leave your HTTP server available to receive new requests.</p>
<p>If your handler is a light code and you want to execute it really fast, you can set this flag to <code>false</code> and let the server execute it as fast as it can without allocating any special resource for that. But here you must thread lightly, because you&#39;ll be consuming resources from your HTTP server and possibly affecting new requests to your app. Only change this flag to <code>false</code> if you really know how its going to affect to your server. The default value for this flag is <code>true</code>.</p>

				</article>
			</div>
		</div>
	</main>


	<script src="/scripts/all.js"></script>
	
	<script src="/scripts/learn.js"></script>
	<script src="/vendor/scripts/highlight.pack.min.js"></script>


	<!-- Intercom -->
	<script>
	window.intercomSettings = { app_id: 'ytqx30hx' };
	(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',intercomSettings);}else{var d=document;var i=function(){i.c(arguments)};i.q=[];i.c=function(args){i.q.push(args)};w.Intercom=i;function l(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/ytqx30hx';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})()
	</script>

	<!-- Analytics -->
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-37033501-2', 'auto');
	ga('send', 'pageview');
	</script>

	<!-- Inspectlet -->
	<script id="inspectletjs">
	window.__insp = window.__insp || [];
	__insp.push(['wid', 1029478452]);
	(function() {
		function ldinsp(){var insp = document.createElement('script'); insp.type = 'text/javascript'; insp.async = true; insp.id = "inspsync"; insp.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://cdn.inspectlet.com/inspectlet.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(insp, x); };
		document.readyState != "complete" ? (window.attachEvent ? window.attachEvent('onload', ldinsp) : window.addEventListener('load', ldinsp, false)) : ldinsp();
	})();
	</script>
</body>
</html>