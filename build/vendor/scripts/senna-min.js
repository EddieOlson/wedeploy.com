/**
 * Senna.js - A blazing-fast Single Page Application engine
 * @author Eduardo Lundgren <edu@rdo.io>
 * @version v1.0.0-alpha
 * @link http://sennajs.com
 * @license BSD-3-Clause
 */
(function(){this.senna=this.senna||{},this.sennaNamed=this.sennaNamed||{};var t={};t["typeof"]="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},t.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},t.possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},function(){var e=function(){function e(){t.classCallCheck(this,e)}return e.abstractMethod=function(){throw Error("Unimplemented abstract method")},e.collectSuperClassesProperty=function(t,e){for(var n=[t[e]];t.__proto__&&!t.__proto__.isPrototypeOf(Function);)t=t.__proto__,n.push(t[e]);return n},e.getFunctionName=function(t){if(!t.name){var e=t.toString();t.name=e.substring(9,e.indexOf("("))}return t.name},e.getUid=function(t){return t?t[e.UID_PROPERTY]||(t[e.UID_PROPERTY]=e.uniqueIdCounter_++):e.uniqueIdCounter_++},e.identityFunction=function(t){return t},e.isBoolean=function(t){return"boolean"==typeof t},e.isDef=function(t){return void 0!==t},e.isDefAndNotNull=function(t){return e.isDef(t)&&!e.isNull(t)},e.isDocument=function(e){return e&&"object"===("undefined"==typeof e?"undefined":t["typeof"](e))&&9===e.nodeType},e.isElement=function(e){return e&&"object"===("undefined"==typeof e?"undefined":t["typeof"](e))&&1===e.nodeType},e.isFunction=function(t){return"function"==typeof t},e.isNull=function(t){return null===t},e.isNumber=function(t){return"number"==typeof t},e.isWindow=function(t){return null!==t&&t===t.window},e.isObject=function(e){var n="undefined"==typeof e?"undefined":t["typeof"](e);return"object"===n&&null!==e||"function"===n},e.isString=function(t){return"string"==typeof t},e.mergeSuperClassesProperty=function(t,n,o){var i=n+"_MERGED";if(t.hasOwnProperty(i))return!1;var r=e.collectSuperClassesProperty(t,n);return o&&(r=o(r)),t[i]=r,!0},e.nullFunction=function(){},e}();e.UID_PROPERTY="core_"+Date.now()%1e9+(1e9*Math.random()>>>0),e.uniqueIdCounter_=1,this.senna.core=e}.call(this),function(){var e=this.senna.core,n=function(){function n(){t.classCallCheck(this,n)}return n.equal=function(t,e){for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return t.length===e.length},n.firstDefinedValue=function(t){for(var e=0;e<t.length;e++)if(void 0!==t[e])return t[e]},n.flatten=function(t,e){for(var o=e||[],i=0;i<t.length;i++)Array.isArray(t[i])?n.flatten(t[i],o):o.push(t[i]);return o},n.remove=function(t,e){var o,i=t.indexOf(e);return(o=i>=0)&&n.removeAt(t,i),o},n.removeAt=function(t,e){return 1===Array.prototype.splice.call(t,e,1).length},n.slice=function(t,n,o){for(var i=[],r=e.isDef(o)?o:t.length,s=n;r>s;s++)i.push(t[s]);return i},n}();this.senna.array=n}.call(this),function(){var t={};t.throwException=function(e){t.nextTick(function(){throw e})},t.run=function(e,n){t.run.workQueueScheduled_||(t.nextTick(t.run.processWorkQueue),t.run.workQueueScheduled_=!0),t.run.workQueue_.push(new t.run.WorkItem_(e,n))},t.run.workQueueScheduled_=!1,t.run.workQueue_=[],t.run.processWorkQueue=function(){for(;t.run.workQueue_.length;){var e=t.run.workQueue_;t.run.workQueue_=[];for(var n=0;n<e.length;n++){var o=e[n];try{o.fn.call(o.scope)}catch(i){t.throwException(i)}}}t.run.workQueueScheduled_=!1},t.run.WorkItem_=function(t,e){this.fn=t,this.scope=e},t.nextTick=function(e,n){var o=e;return n&&(o=e.bind(n)),o=t.nextTick.wrapCallback_(o),"function"==typeof setImmediate?void setImmediate(o):(t.nextTick.setImmediate_||(t.nextTick.setImmediate_=t.nextTick.getSetImmediateEmulator_()),void t.nextTick.setImmediate_(o))},t.nextTick.setImmediate_=null,t.nextTick.getSetImmediateEmulator_=function(){var t;if("function"==typeof MessageChannel&&(t=MessageChannel),"undefined"==typeof t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&(t=function(){var t=document.createElement("iframe");t.style.display="none",t.src="",document.documentElement.appendChild(t);var e=t.contentWindow,n=e.document;n.open(),n.write(""),n.close();var o="callImmediate"+Math.random(),i=e.location.protocol+"//"+e.location.host,r=function(t){(t.origin===i||t.data===o)&&this.port1.onmessage()}.bind(this);e.addEventListener("message",r,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(o,i)}}}),"undefined"!=typeof t){var e=new t,n={},o=n;return e.port1.onmessage=function(){n=n.next;var t=n.cb;n.cb=null,t()},function(t){o.next={cb:t},o=o.next,e.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("script")?function(t){var e=document.createElement("script");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){setTimeout(t,0)}},t.nextTick.wrapCallback_=function(t){return t},this.senna.async=t}.call(this),function(){var e=this.senna.core,n=function(){function n(){t.classCallCheck(this,n)}return n.mixin=function(t){for(var e,n,o=1;o<arguments.length;o++){n=arguments[o];for(e in n)t[e]=n[e]}return t},n.getObjectByName=function(t,n){for(var o,i=t.split("."),r=n||window;o=i.shift();){if(!e.isDefAndNotNull(r[o]))return null;r=r[o]}return r},n.map=function(t,e){for(var n={},o=Object.keys(t),i=0;i<o.length;i++)n[o[i]]=e(o[i],t[o[i]]);return n},n}();this.senna.object=n}.call(this),function(){var e=function(){function e(){t.classCallCheck(this,e),this.disposed_=!1}return e.prototype.dispose=function(){this.disposed_||(this.disposeInternal(),this.disposed_=!0)},e.prototype.disposeInternal=function(){},e.prototype.isDisposed=function(){return this.disposed_},e}();this.senna.Disposable=e}.call(this),function(){var e=this.senna.Disposable,n=function(e){function n(o,i,r){t.classCallCheck(this,n);var s=t.possibleConstructorReturn(this,e.call(this));return s.emitter_=o,s.event_=i,s.listener_=r,s}return t.inherits(n,e),n.prototype.disposeInternal=function(){this.removeListener(),this.emitter_=null,this.listener_=null},n.prototype.removeListener=function(){this.emitter_.isDisposed()||this.emitter_.removeListener(this.event_,this.listener_)},n}(e);n.prototype.registerMetalComponent&&n.prototype.registerMetalComponent(n,"EventHandle"),this.senna.EventHandle=n}.call(this),function(){var e=this.senna.EventHandle,n=function(e){function n(o,i,r,s){t.classCallCheck(this,n);var a=t.possibleConstructorReturn(this,e.call(this,o,i,r));return a.capture_=s,a}return t.inherits(n,e),n.prototype.removeListener=function(){this.emitter_.removeEventListener(this.event_,this.listener_,this.capture_)},n}(e);n.prototype.registerMetalComponent&&n.prototype.registerMetalComponent(n,"DomEventHandle"),this.senna.DomEventHandle=n}.call(this),function(){var e=this.senna.core,n=this.senna.object,o=this.senna.DomEventHandle,i=function(){function i(){t.classCallCheck(this,i)}return i.addClasses=function(t,n){e.isObject(t)&&e.isString(n)&&("classList"in t?i.addClassesWithNative_(t,n):i.addClassesWithoutNative_(t,n))},i.addClassesWithNative_=function(t,e){e.split(" ").forEach(function(e){t.classList.add(e)})},i.addClassesWithoutNative_=function(t,e){var n=" "+t.className+" ",o="";e=e.split(" ");for(var i=0;i<e.length;i++){var r=e[i];-1===n.indexOf(" "+r+" ")&&(o+=" "+r)}o&&(t.className=t.className+o)},i.append=function(t,n){if(e.isString(n)&&(n=i.buildFragment(n)),n instanceof NodeList)for(var o=Array.prototype.slice.call(n),r=0;r<o.length;r++)t.appendChild(o[r]);else t.appendChild(n);return n},i.buildFragment=function(t){var e=document.createElement("div");e.innerHTML="<br>"+t,e.removeChild(e.firstChild);for(var n=document.createDocumentFragment();e.firstChild;)n.appendChild(e.firstChild);return n},i.contains=function(t,n){return e.isDocument(t)?t.documentElement.contains(n):t.contains(n)},i.delegate=function(t,e,n,o){var r=i.customEvents[e];return r&&r.delegate&&(e=r.originalEvent,o=r.handler.bind(r,o)),i.on(t,e,i.handleDelegateEvent_.bind(null,n,o))},i.enterDocument=function(t){i.append(document.body,t)},i.exitDocument=function(t){t.parentNode&&t.parentNode.removeChild(t)},i.handleDelegateEvent_=function(t,n,o){i.normalizeDelegateEvent_(o);for(var r=o.target,s=!0;r&&!o.stopped&&(e.isString(t)&&i.match(r,t)&&(o.delegateTarget=r,s&=n(o)),r!==o.currentTarget);)r=r.parentNode;return o.delegateTarget=null,s},i.hasClass=function(t,e){return"classList"in t?i.hasClassWithNative_(t,e):i.hasClassWithoutNative_(t,e)},i.hasClassWithNative_=function(t,e){return t.classList.contains(e)},i.hasClassWithoutNative_=function(t,e){return(" "+t.className+" ").indexOf(" "+e+" ")>=0},i.isEmpty=function(t){return 0===t.childNodes.length},i.match=function(t,e){if(!t||1!==t.nodeType)return!1;var n=Element.prototype,o=n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector;return o?o.call(t,e):i.matchFallback_(t,e)},i.matchFallback_=function(t,e){for(var n=document.querySelectorAll(e,t.parentNode),o=0;o<n.length;++o)if(n[o]===t)return!0;return!1},i.next=function(t,e){do if(t=t.nextSibling,t&&i.match(t,e))return t;while(t);return null},i.normalizeDelegateEvent_=function(t){t.stopPropagation=i.stopPropagation_,t.stopImmediatePropagation=i.stopImmediatePropagation_},i.on=function(t,n,r,s){if(e.isString(t))return i.delegate(document,n,t,r);var a=i.customEvents[n];return a&&a.event&&(n=a.originalEvent,r=a.handler.bind(a,r)),t.addEventListener(n,r,s),new o(t,n,r,s)},i.once=function(t,e,n){var o=this.on(t,e,function(){return o.removeListener(),n.apply(this,arguments)});return o},i.registerCustomEvent=function(t,e){i.customEvents[t]=e},i.removeChildren=function(t){for(var e;e=t.firstChild;)t.removeChild(e)},i.removeClasses=function(t,n){e.isObject(t)&&e.isString(n)&&("classList"in t?i.removeClassesWithNative_(t,n):i.removeClassesWithoutNative_(t,n))},i.removeClassesWithNative_=function(t,e){e.split(" ").forEach(function(e){t.classList.remove(e)})},i.removeClassesWithoutNative_=function(t,e){var n=" "+t.className+" ";e=e.split(" ");for(var o=0;o<e.length;o++)n=n.replace(" "+e[o]+" "," ");t.className=n.trim()},i.replace=function(t,e){t&&e&&t!==e&&t.parentNode&&(t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t))},i.stopImmediatePropagation_=function(){this.stopped=!0,Event.prototype.stopImmediatePropagation.call(this)},i.stopPropagation_=function(){this.stopped=!0,Event.prototype.stopPropagation.call(this)},i.supportsEvent=function(t,n){return i.customEvents[n]?!0:(e.isString(t)&&(r[t]||(r[t]=document.createElement(t)),t=r[t]),"on"+n in t)},i.toElement=function(t){return e.isElement(t)||e.isDocument(t)?t:e.isString(t)?"#"===t[0]&&-1===t.indexOf(" ")?document.getElementById(t.substr(1)):document.querySelector(t):null},i.toggleClasses=function(t,n){e.isObject(t)&&e.isString(n)&&("classList"in t?i.toggleClassesWithNative_(t,n):i.toggleClassesWithoutNative_(t,n))},i.toggleClassesWithNative_=function(t,e){e.split(" ").forEach(function(e){t.classList.toggle(e)})},i.toggleClassesWithoutNative_=function(t,e){var n=" "+t.className+" ";e=e.split(" ");for(var o=0;o<e.length;o++){var i=" "+e[o]+" ",r=n.indexOf(i);n=-1===r?n+e[o]+" ":n.substring(0,r)+" "+n.substring(r+i.length)}t.className=n.trim()},i.triggerEvent=function(t,e,o){var i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!0),n.mixin(i,o),t.dispatchEvent(i)},i}(),r={};i.customEvents={},this.senna.dom=i}.call(this),function(){var e=this.senna.core,n=this.senna.array,o=this.senna.Disposable,i=this.senna.EventHandle,r=function(o){function r(){t.classCallCheck(this,r);var e=t.possibleConstructorReturn(this,o.call(this));return e.events_=[],e.maxListeners_=10,e.shouldUseFacade_=!1,e}return t.inherits(r,o),r.prototype.addListener=function(t,e,n){this.validateListener_(e),t=this.normalizeEvents_(t);for(var o=0;o<t.length;o++)this.addSingleListener_(t[o],e,n);return new i(this,t,e)},r.prototype.addSingleListener_=function(t,e,n,o){this.emit("newListener",t,e),this.events_[t]||(this.events_[t]=[]),this.events_[t].push({"default":n,fn:e,origin:o});var i=this.events_[t];i.length>this.maxListeners_&&!i.warned&&(i.warned=!0)},r.prototype.disposeInternal=function(){this.events_=[]},r.prototype.emit=function(t){var e,o=n.slice(arguments,1),i=(this.events_[t]||[]).concat();this.getShouldUseFacade()&&(e={preventDefault:function(){e.preventedDefault=!0},target:this,type:t},o.push(e));for(var r=[],s=0;s<i.length;s++)i[s]["default"]?r.push(i[s]):i[s].fn.apply(this,o);if(!e||!e.preventedDefault)for(var a=0;a<r.length;a++)r[a].fn.apply(this,o);return"*"!==t&&this.emit.apply(this,["*",t].concat(o)),i.length>0},r.prototype.getShouldUseFacade=function(){return this.shouldUseFacade_},r.prototype.listeners=function(t){return(this.events_[t]||[]).map(function(t){return t.fn})},r.prototype.many=function(t,e,n){t=this.normalizeEvents_(t);for(var o=0;o<t.length;o++)this.many_(t[o],e,n);return new i(this,t,n)},r.prototype.many_=function(t,e,n){function o(){0===--e&&i.removeListener(t,o),n.apply(i,arguments)}var i=this;0>=e||i.addSingleListener_(t,o,!1,n)},r.prototype.matchesListener_=function(t,e){return t.fn===e||t.origin&&t.origin===e},r.prototype.normalizeEvents_=function(t){return e.isString(t)?[t]:t},r.prototype.off=function(t,e){this.validateListener_(e),t=this.normalizeEvents_(t);for(var n=0;n<t.length;n++){var o=this.events_[t[n]]||[];this.removeMatchingListenerObjs_(o,e)}return this},r.prototype.on=function(){return this.addListener.apply(this,arguments)},r.prototype.once=function(t,e){return this.many(t,1,e)},r.prototype.removeAllListeners=function(t){if(t)for(var e=this.normalizeEvents_(t),n=0;n<e.length;n++)this.events_[e[n]]=null;else this.events_={};return this},r.prototype.removeMatchingListenerObjs_=function(t,e){for(var n=t.length-1;n>=0;n--)this.matchesListener_(t[n],e)&&t.splice(n,1)},r.prototype.removeListener=function(){return this.off.apply(this,arguments)},r.prototype.setMaxListeners=function(t){return this.maxListeners_=t,this},r.prototype.setShouldUseFacade=function(t){return this.shouldUseFacade_=t,this},r.prototype.validateListener_=function(t){if(!e.isFunction(t))throw new TypeError("Listener must be a function")},r}(o);r.prototype.registerMetalComponent&&r.prototype.registerMetalComponent(r,"EventEmitter"),this.senna.EventEmitter=r}.call(this),function(){var e=this.senna.Disposable,n=function(e){function n(){t.classCallCheck(this,n);var o=t.possibleConstructorReturn(this,e.call(this));return o.eventHandles_=[],o}return t.inherits(n,e),n.prototype.add=function(){for(var t=0;t<arguments.length;t++)this.eventHandles_.push(arguments[t])},n.prototype.disposeInternal=function(){this.eventHandles_=null},n.prototype.removeAllListeners=function(){for(var t=0;t<this.eventHandles_.length;t++)this.eventHandles_[t].removeListener();this.eventHandles_=[]},n}(e);n.prototype.registerMetalComponent&&n.prototype.registerMetalComponent(n,"EventHandler"),this.senna.EventHandler=n}.call(this),function(){var e=this.senna.core,n=this.senna.async,o=function(){};o.prototype.then=function(){},o.IMPLEMENTED_BY_PROP="$goog_Thenable",o.addImplementation=function(t){t.prototype.then=t.prototype.then,t.prototype.$goog_Thenable=!0},o.isImplementedBy=function(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(e){return!1}};var i=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){var n=e.slice();return n.push.apply(n,arguments),t.apply(this,n)}},r=function s(t,e){this.state_=s.State_.PENDING,this.result_=void 0,this.parent_=null,this.callbackEntries_=null,this.executing_=!1,s.UNHANDLED_REJECTION_DELAY>0?this.unhandledRejectionId_=0:0===s.UNHANDLED_REJECTION_DELAY&&(this.hadUnhandledRejection_=!1);try{var n=this;t.call(e,function(t){n.resolve_(s.State_.FULFILLED,t)},function(t){n.resolve_(s.State_.REJECTED,t)})}catch(o){this.resolve_(s.State_.REJECTED,o)}};r.UNHANDLED_REJECTION_DELAY=0,r.State_={PENDING:0,BLOCKED:1,FULFILLED:2,REJECTED:3},r.CallbackEntry_=null,r.resolve=function(t){return new r(function(e){e(t)})},r.reject=function(t){return new r(function(e,n){n(t)})},r.race=function(t){return new r(function(e,n){t.length||e(void 0);for(var o,i=0;o=t[i];i++)o.then(e,n)})},r.all=function(t){return new r(function(e,n){var o=t.length,r=[];if(!o)return void e(r);for(var s,a=function(t,n){o--,r[t]=n,0===o&&e(r)},l=function(t){n(t)},c=0;s=t[c];c++)s.then(i(a,c),l)})},r.firstFulfilled=function(t){return new r(function(e,n){var o=t.length,r=[];if(!o)return void e(void 0);for(var s,a=function(t){e(t)},l=function(t,e){o--,r[t]=e,0===o&&n(r)},c=0;s=t[c];c++)s.then(a,i(l,c))})},r.prototype.then=function(t,n,o){return this.addChildPromise_(e.isFunction(t)?t:null,e.isFunction(n)?n:null,o)},o.addImplementation(r),r.prototype.thenAlways=function(t,e){var n=function(){try{t.call(e)}catch(n){r.handleRejection_.call(null,n)}};return this.addCallbackEntry_({child:null,onRejected:n,onFulfilled:n}),this},r.prototype.thenCatch=function(t,e){return this.addChildPromise_(null,t,e)},r.prototype["catch"]=r.prototype.thenCatch,r.prototype.cancel=function(t){this.state_===r.State_.PENDING&&n.run(function(){var e=new r.CancellationError(t);e.IS_CANCELLATION_ERROR=!0,this.cancelInternal_(e)},this)},r.prototype.cancelInternal_=function(t){this.state_===r.State_.PENDING&&(this.parent_?this.parent_.cancelChild_(this,t):this.resolve_(r.State_.REJECTED,t))},r.prototype.cancelChild_=function(t,e){if(this.callbackEntries_){for(var n,o=0,i=-1,s=0;n=this.callbackEntries_[s];s++){var a=n.child;if(a&&(o++,a===t&&(i=s),i>=0&&o>1))break}if(i>=0)if(this.state_===r.State_.PENDING&&1===o)this.cancelInternal_(e);else{var l=this.callbackEntries_.splice(i,1)[0];this.executeCallback_(l,r.State_.REJECTED,e)}}},r.prototype.addCallbackEntry_=function(t){this.callbackEntries_&&this.callbackEntries_.length||this.state_!==r.State_.FULFILLED&&this.state_!==r.State_.REJECTED||this.scheduleCallbacks_(),this.callbackEntries_||(this.callbackEntries_=[]),this.callbackEntries_.push(t)},r.prototype.addChildPromise_=function(t,n,o){var i={child:null,onFulfilled:null,onRejected:null};return i.child=new r(function(r,s){i.onFulfilled=t?function(e){try{var n=t.call(o,e);r(n)}catch(i){s(i)}}:r,i.onRejected=n?function(t){try{var i=n.call(o,t);!e.isDef(i)&&t.IS_CANCELLATION_ERROR?s(t):r(i)}catch(a){s(a)}}:s}),i.child.parent_=this,this.addCallbackEntry_(i),i.child},r.prototype.unblockAndFulfill_=function(t){if(this.state_!==r.State_.BLOCKED)throw new Error("CancellablePromise is not blocked.");this.state_=r.State_.PENDING,this.resolve_(r.State_.FULFILLED,t)},r.prototype.unblockAndReject_=function(t){if(this.state_!==r.State_.BLOCKED)throw new Error("CancellablePromise is not blocked.");this.state_=r.State_.PENDING,this.resolve_(r.State_.REJECTED,t)},r.prototype.resolve_=function(t,n){if(this.state_===r.State_.PENDING){if(this===n)t=r.State_.REJECTED,n=new TypeError("CancellablePromise cannot resolve to itself");else{if(o.isImplementedBy(n))return n=n,this.state_=r.State_.BLOCKED,void n.then(this.unblockAndFulfill_,this.unblockAndReject_,this);if(e.isObject(n))try{var i=n.then;if(e.isFunction(i))return void this.tryThen_(n,i)}catch(s){t=r.State_.REJECTED,n=s}}this.result_=n,this.state_=t,this.scheduleCallbacks_(),t!==r.State_.REJECTED||n.IS_CANCELLATION_ERROR||r.addUnhandledRejection_(this,n)}},r.prototype.tryThen_=function(t,e){this.state_=r.State_.BLOCKED;var n=this,o=!1,i=function(t){o||(o=!0,n.unblockAndFulfill_(t))},s=function(t){o||(o=!0,n.unblockAndReject_(t))};try{e.call(t,i,s)}catch(a){s(a)}},r.prototype.scheduleCallbacks_=function(){this.executing_||(this.executing_=!0,n.run(this.executeCallbacks_,this))},r.prototype.executeCallbacks_=function(){for(;this.callbackEntries_&&this.callbackEntries_.length;){var t=this.callbackEntries_;this.callbackEntries_=[];for(var e=0;e<t.length;e++)this.executeCallback_(t[e],this.state_,this.result_)}this.executing_=!1},r.prototype.executeCallback_=function(t,e,n){e===r.State_.FULFILLED?t.onFulfilled(n):(this.removeUnhandledRejection_(),t.onRejected(n))},r.prototype.removeUnhandledRejection_=function(){var t;if(r.UNHANDLED_REJECTION_DELAY>0)for(t=this;t&&t.unhandledRejectionId_;t=t.parent_)clearTimeout(t.unhandledRejectionId_),t.unhandledRejectionId_=0;else if(0===r.UNHANDLED_REJECTION_DELAY)for(t=this;t&&t.hadUnhandledRejection_;t=t.parent_)t.hadUnhandledRejection_=!1},r.addUnhandledRejection_=function(t,e){r.UNHANDLED_REJECTION_DELAY>0?t.unhandledRejectionId_=setTimeout(function(){r.handleRejection_.call(null,e)},r.UNHANDLED_REJECTION_DELAY):0===r.UNHANDLED_REJECTION_DELAY&&(t.hadUnhandledRejection_=!0,n.run(function(){t.hadUnhandledRejection_&&r.handleRejection_.call(null,e)}))},r.handleRejection_=n.throwException,r.setUnhandledRejectionHandler=function(t){r.handleRejection_=t},r.CancellationError=function(e){function n(o){t.classCallCheck(this,n);var i=t.possibleConstructorReturn(this,e.call(this,o));return o&&(i.message=o),i}return t.inherits(n,e),n}(Error),r.CancellationError.prototype.name="cancel",this.sennaNamed.Promise={},this.sennaNamed.Promise.CancellablePromise=r,this.senna.Promise=r}.call(this),function(){var t={document:document,window:window};this.senna.globals=t}.call(this),function(){var e=this.senna.core,n=function(){function n(o,i){if(t.classCallCheck(this,n),!e.isDefAndNotNull(o))throw new Error("Route path not specified.");if(!e.isFunction(i))throw new Error("Route handler is not a function.");this.handler=i,this.path=o}return n.prototype.getHandler=function(){return this.handler},n.prototype.getPath=function(){return this.path},n.prototype.matchesPath=function(t){var n=this.path;return e.isString(n)?t===n:e.isFunction(n)?n(t):n instanceof RegExp?t.search(n)>-1:!1},n}();this.senna.Route=n}.call(this),function(){var e=this.senna.Disposable,n=function(e){function n(){t.classCallCheck(this,n);var o=t.possibleConstructorReturn(this,e.call(this));return o.cache=null,o.cacheable=!1,o}return t.inherits(n,e),n.prototype.addCache=function(t){return this.cacheable&&(this.cache=t),this},n.prototype.clearCache=function(){return this.cache=null,this},n.prototype.disposeInternal=function(){this.clearCache()},n.prototype.getCache=function(){return this.cache},n.prototype.isCacheable=function(){return this.cacheable},n.prototype.setCacheable=function(t){t||this.clearCache(),this.cacheable=t},n}(e);n.prototype.registerMetalComponent&&n.prototype.registerMetalComponent(n,"Cacheable"),this.senna.Cacheable=n}.call(this),function(){var e=this.senna.core,n=this.senna.Cacheable,o=this.senna.Promise,i=function(n){function i(){t.classCallCheck(this,i);var o=t.possibleConstructorReturn(this,n.call(this));return o.id=o.makeId_(e.getUid()),o.title=null,o}return t.inherits(i,n),i.prototype.activate=function(){},i.prototype.beforeDeactivate=function(){},i.prototype.beforeUpdateHistoryPath=function(t){return t},i.prototype.beforeUpdateHistoryState=function(t){return t},i.prototype.deactivate=function(){},i.prototype.disposeInternal=function(){n.prototype.disposeInternal.call(this)},i.prototype.flip=function(t){var e=this,n=[];return Object.keys(t).forEach(function(o){return n.push(t[o].show(e.id))}),o.all(n)},i.prototype.getId=function(){return this.id},i.prototype.getSurfaceContent=function(){},i.prototype.getTitle=function(){return this.title},i.prototype.load=function(){return o.resolve()},i.prototype.makeId_=function(t){return"screen_"+t},i.prototype.setId=function(t){this.id=t},i.prototype.setTitle=function(t){this.title=t},i.prototype.toString=function(){return this.id},i}(n);i.prototype.registerMetalComponent&&i.prototype.registerMetalComponent(i,"Screen"),i.isImplementedBy=function(t){return t instanceof i},this.senna.Screen=i}.call(this),function(){var e=this.senna.dom,n=function(){function n(){t.classCallCheck(this,n)}return n.run=function(t){var e=document.createElement("script");e.text=t,document.head.appendChild(e).parentNode.removeChild(e)},n.runFile=function(t,n){var o=document.createElement("script");o.src=t;var i=function(){o.parentNode.removeChild(o),n&&n()};e.on(o,"load",i),e.on(o,"error",i),document.head.appendChild(o)},n.runScript=function(t,e){return t.type&&"text/javascript"!==t.type?void(e&&e()):(t.parentNode&&t.parentNode.removeChild(t),void(t.src?n.runFile(t.src,e):(n.run(t.text),e&&e())))},n.runScriptsInElement=function(t,e){var o=t.querySelectorAll("script");o.length?n.runScriptsInOrder(o,0,e):e&&e()},n.runScriptsInOrder=function(t,e,o){n.runScript(t.item(e),function(){e<t.length-1?n.runScriptsInOrder(t,e+1,o):o&&o()})},n}();this.senna.globalEval=n}.call(this),function(){var e=this.senna.globals,n=this.senna.core,o=this.senna.dom,i=this.senna.globalEval,r=this.senna.Disposable,s=this.senna.Promise,a=function(r){function a(e){t.classCallCheck(this,a);var n=t.possibleConstructorReturn(this,r.call(this));if(!e)throw new Error("Surface element id not specified. A surface element requires a valid id.");return n.activeChild=null,n.defaultChild=null,n.element=null,n.id=e,n.transitionFn=null,n.defaultChild=n.getChild(a.DEFAULT),n.maybeWrapContentAsDefault_(),n.activeChild=n.defaultChild,n}return t.inherits(a,r),a.prototype.addContent=function(t,e,r){var s=this.defaultChild;n.isDefAndNotNull(e)&&(s=this.createChild(t),o.append(s,e)),this.transition(s,null);var a=this.getElement();return a&&s&&(o.append(a,s),r&&i.runScriptsInElement(s)),s},a.prototype.createChild=function(t){var n=e.document.createElement("div");return n.setAttribute("id",this.makeId_(t)),n},a.prototype.getChild=function(t){return e.document.getElementById(this.makeId_(t))},a.prototype.getElement=function(){return this.element?this.element:(this.element=e.document.getElementById(this.id),this.element)},a.prototype.getId=function(){return this.id},a.prototype.getTransitionFn=function(){return this.transitionFn},a.prototype.makeId_=function(t){return this.id+"-"+t},a.prototype.maybeWrapContentAsDefault_=function(){var t=this.getElement();if(t&&!this.defaultChild){for(var n=e.document.createDocumentFragment();t.firstChild;)n.appendChild(t.firstChild);this.defaultChild=this.addContent(a.DEFAULT,n,!1),this.transition(null,this.defaultChild)}},a.prototype.setId=function(t){this.id=t},a.prototype.setTransitionFn=function(t){this.transitionFn=t},a.prototype.show=function(t){var e=this.activeChild,n=this.getChild(t);return n||(n=this.defaultChild),this.activeChild=n,this.transition(e,n).thenAlways(function(){e&&e!==n&&o.exitDocument(e)})},a.prototype.remove=function(t){var e=this.getChild(t);e&&o.exitDocument(e)},a.prototype.toString=function(){return this.id},a.prototype.transition=function(t,e){var n=this.transitionFn||a.defaultTransition;return s.resolve(n.call(this,t,e))},a}(r);a.prototype.registerMetalComponent&&a.prototype.registerMetalComponent(a,"Surface"),a.DEFAULT="default",a.defaultTransition=function(t,e){t&&(t.style.display="none",t.classList.remove("flipped")),e&&(e.style.display="block",e.classList.add("flipped"))},this.senna.Surface=a}.call(this),function(){var e=this.senna.array,n=this.senna.async,o=this.senna.core,i=this.senna.dom,r=this.senna.EventEmitter,s=this.senna.EventHandler,a=this.senna.Promise,l=this.senna.globals,c=this.senna.Route,u=this.senna.Screen,h=this.senna.Surface,p=function(r){function p(){t.classCallCheck(this,p);var e=t.possibleConstructorReturn(this,r.call(this));return e.activeScreen=null,e.activePath=null,e.basePath="",e.captureScrollPositionFromScrollEvent=!0,e.defaultTitle="",e.formSelector='form[enctype="multipart/form-data"]:not([data-senna-off])',e.linkSelector="a:not([data-senna-off])",e.loadingCssClass="senna-loading",e.nativeScrollRestorationSupported="scrollRestoration"in l.window.history,e.pendingNavigate=null,e.popstateScrollLeft=0,e.popstateScrollTop=0,e.routes=[],e.screens={},e.scrollHandle=null,e.skipLoadPopstate=!1,e.surfaces={},e.updateScrollPosition=!0,e.appEventHandlers_=new s,e.appEventHandlers_.add(i.on(l.window,"scroll",e.onScroll_.bind(e)),i.on(l.window,"load",e.onLoad_.bind(e)),i.on(l.window,"popstate",e.onPopstate_.bind(e))),e.on("startNavigate",e.onStartNavigate_),e.on("beforeNavigate",e.onBeforeNavigate_,!0),e.setLinkSelector(e.linkSelector),e.setFormSelector(e.formSelector),e}return t.inherits(p,r),p.prototype.addRoutes=function(t){var e=this;return Array.isArray(t)||(t=[t]),t.forEach(function(t){t instanceof c||(t=new c(t.path,t.handler)),e.routes.push(t)}),this},p.prototype.addSurfaces=function(t){var e=this;return Array.isArray(t)||(t=[t]),t.forEach(function(t){o.isString(t)&&(t=new h(t)),e.surfaces[t.getId()]=t}),this},p.prototype.clearScreensCache=function(){var t=this;Object.keys(this.screens).forEach(function(e){e!==t.activePath&&t.removeScreen_(e,t.screens[e])})},p.prototype.createScreenInstance=function(t,e){var n;t===this.activePath&&(n=this.screens[t],delete this.screens[t]);var o=this.screens[t];if(!o){var i=e.getHandler();o=i===u||u.isImplementedBy(i.prototype)?new i:i(e)||new u,n&&o.addCache(n.getCache())}return o},p.prototype.disposeInternal=function(){this.activeScreen&&this.removeScreen_(this.activePath,this.activeScreen),this.clearScreensCache(),this.formEventHandler_.removeListener(),this.linkEventHandler_.removeListener(),this.appEventHandlers_.removeAllListeners(),r.prototype.disposeInternal.call(this)},p.prototype.dispatch=function(){var t=l.window.location.pathname+l.window.location.search+l.window.location.hash;return this.navigate(t,!0)},p.prototype.doNavigate_=function(t,e){var n=this;if(this.activeScreen&&this.activeScreen.beforeDeactivate())return this.pendingNavigate=a.reject(new a.CancellationError("Cancelled by active screen")),this.pendingNavigate;var o=this.findRoute(t);if(!o)return this.pendingNavigate=a.reject(new a.CancellationError("No route for "+t)),this.pendingNavigate;var i=this.createScreenInstance(t,o);return i.load(t).then(function(){return n.activeScreen&&n.activeScreen.deactivate(),n.prepareNavigateHistory_(t,i,e),n.prepareNavigateSurfaces_(i,n.surfaces),i.flip(n.surfaces)}).then(function(){return n.syncScrollPositionSyncThenAsync_()}).then(function(){return n.finalizeNavigate_(t,i)})["catch"](function(e){throw n.handleNavigateError_(t,i,e),e})},p.prototype.finalizeNavigate_=function(t,e){e.activate(),this.activeScreen&&!this.activeScreen.isCacheable()&&this.removeScreen_(this.activePath,this.activeScreen),this.activePath=t,this.activeScreen=e,this.screens[t]=e,l.capturedFormElement=null},p.prototype.findRoute=function(t){if(t.lastIndexOf("#")>-1&&this.isPathCurrentBrowserPath(t))return null;t=this.maybeRemovePathHashbang(t).substr(this.basePath.length);for(var e=0;e<this.routes.length;e++){var n=this.routes[e];if(n.matchesPath(t))return n}return null},p.prototype.getBasePath=function(){return this.basePath},p.prototype.getDefaultTitle=function(){return this.defaultTitle},p.prototype.getFormSelector=function(){return this.formSelector},p.prototype.getLinkSelector=function(){return this.linkSelector},p.prototype.getLoadingCssClass=function(){return this.loadingCssClass},p.prototype.getUpdateScrollPosition=function(){return this.updateScrollPosition},p.prototype.handleNavigateError_=function(t,e,n){this.removeScreen_(t,e)},p.prototype.hasRoutes=function(){return this.routes.length>0},p.prototype.isPathCurrentBrowserPath=function(t){return t?this.maybeRemovePathHashbang(t)===l.window.location.pathname+l.window.location.search:!1},p.prototype.isHtml5HistorySupported=function(){return l.window.history&&l.window.history.pushState},p.prototype.isLinkSameOrigin_=function(t){return t===l.window.location.hostname},p.prototype.isSameBasePath_=function(t){return 0===t.indexOf(this.basePath)},p.prototype.lockHistoryScrollPosition_=function(){var t=l.window.history.state;if(t){var e=!1,o=function i(){l.document.removeEventListener("scroll",i,!1),
e||(l.window.scrollTo(t.scrollLeft,t.scrollTop),e=!0)};n.nextTick(o),l.document.addEventListener("scroll",o,!1)}},p.prototype.maybeDisableNativeScrollRestoration=function(){this.nativeScrollRestorationSupported&&(this.nativeScrollRestoration_=l.window.history.scrollRestoration,l.window.history.scrollRestoration="manual")},p.prototype.maybeNavigateToLinkElement_=function(t,e){var n=t.pathname+t.search+t.hash;if(this.isLinkSameOrigin_(t.hostname)&&this.isSameBasePath_(n)&&this.findRoute(n)){var o=!1;try{this.navigate(n)}catch(i){o=!0}o||e.preventDefault()}},p.prototype.maybeRemovePathHashbang=function(t){var e=t.lastIndexOf("#");return e>-1&&(t=t.substr(0,e)),t},p.prototype.maybeRepositionScrollToHashedAnchor=function(){var t=l.window.location.hash;if(t){var e=l.document.getElementById(t.substring(1));e&&l.window.scrollTo(e.offsetLeft,e.offsetTop)}},p.prototype.maybeRestoreNativeScrollRestoration=function(){this.nativeScrollRestorationSupported&&this.nativeScrollRestoration_&&(l.window.history.scrollRestoration=this.nativeScrollRestoration_)},p.prototype.navigate=function(t,e){if(!this.isHtml5HistorySupported())throw new Error("HTML5 History is not supported. Senna will not intercept navigation.");return t===this.activePath&&(e=!0),this.emit("beforeNavigate",{path:t,replaceHistory:!!e}),this.pendingNavigate},p.prototype.onBeforeNavigate_=function(t){this.emit("startNavigate",{path:t.path,replaceHistory:t.replaceHistory})},p.prototype.onDocClickDelegate_=function(t){t.altKey||t.ctrlKey||t.metaKey||t.shiftKey||t.button||this.maybeNavigateToLinkElement_(t.delegateTarget,t)},p.prototype.onDocSubmitDelegate_=function(t){var e=t.delegateTarget,n=l.document.createElement("a");n.href=e.action,"get"!==e.method&&(l.capturedFormElement=e,this.maybeNavigateToLinkElement_(n,t))},p.prototype.onLoad_=function(){var t=this;this.skipLoadPopstate=!0,setTimeout(function(){t.skipLoadPopstate=!1},0),this.maybeRepositionScrollToHashedAnchor()},p.prototype.onPopstate_=function(t){if(!this.skipLoadPopstate){var e=t.state;return e?void(e.senna&&(this.popstateScrollTop=e.scrollTop,this.popstateScrollLeft=e.scrollLeft,this.nativeScrollRestorationSupported||this.lockHistoryScrollPosition_(),this.navigate(e.path,!0))):void(l.window.location.hash?(this.activePath&&!this.isPathCurrentBrowserPath(this.activePath)&&this.reloadPage(),this.maybeRepositionScrollToHashedAnchor()):this.reloadPage())}},p.prototype.onScroll_=function(){this.captureScrollPositionFromScrollEvent&&this.saveHistoryCurrentPageScrollPosition_()},p.prototype.onStartNavigate_=function(t){var e=this;this.maybeDisableNativeScrollRestoration(),this.captureScrollPositionFromScrollEvent=!1;var n={};l.capturedFormElement&&(t.form=l.capturedFormElement,n.form=l.capturedFormElement);var o=l.document.documentElement;i.addClasses(o,this.loadingCssClass),this.stopPendingNavigate_(),this.pendingNavigate=this.doNavigate_(t.path,t.replaceHistory)["catch"](function(t){throw n.error=t,t}).thenAlways(function(){n.path=t.path,i.removeClasses(o,e.loadingCssClass),e.maybeRestoreNativeScrollRestoration(),e.captureScrollPositionFromScrollEvent=!0,e.emit("endNavigate",n)})},p.prototype.prefetch=function(t){var e=this,n=this.findRoute(t);if(!n)return a.reject(new a.CancellationError("No route for "+t));var o=this.createScreenInstance(t,n);return o.load(t).then(function(){return e.screens[t]=o})["catch"](function(n){throw e.handleNavigateError_(t,o,n),n})},p.prototype.prepareNavigateHistory_=function(t,e,n){var i=e.getTitle();o.isString(i)||(i=this.getDefaultTitle());var r={form:o.isDefAndNotNull(l.capturedFormElement),navigatePath:t,path:e.beforeUpdateHistoryPath(t),senna:!0,scrollTop:0,scrollLeft:0};n&&(r.scrollTop=this.popstateScrollTop,r.scrollLeft=this.popstateScrollLeft),this.updateHistory_(i,r.path,e.beforeUpdateHistoryState(r),n)},p.prototype.prepareNavigateSurfaces_=function(t,e){Object.keys(e).forEach(function(n){var o=t.getSurfaceContent(n);e[n].addContent(t.getId(),o,!0)})},p.prototype.reloadPage=function(){l.window.location.reload()},p.prototype.removeRoute=function(t){return e.remove(this.routes,t)},p.prototype.removeScreen_=function(t,e){var n=this;Object.keys(this.surfaces).forEach(function(t){return n.surfaces[t].remove(e.getId())}),e.dispose(),delete this.screens[t]},p.prototype.saveHistoryCurrentPageScrollPosition_=function(){var t=l.window.history.state;t&&t.senna&&(t.scrollTop=l.window.pageYOffset,t.scrollLeft=l.window.pageXOffset,l.window.history.replaceState(t,null,null))},p.prototype.setBasePath=function(t){this.basePath=t},p.prototype.setDefaultTitle=function(t){this.defaultTitle=t},p.prototype.setFormSelector=function(t){this.formSelector=t,this.formEventHandler_&&this.formEventHandler_.removeListener(),this.formEventHandler_=i.delegate(document,"submit",this.formSelector,this.onDocSubmitDelegate_.bind(this))},p.prototype.setLinkSelector=function(t){this.linkSelector=t,this.linkEventHandler_&&this.linkEventHandler_.removeListener(),this.linkEventHandler_=i.delegate(document,"click",this.linkSelector,this.onDocClickDelegate_.bind(this))},p.prototype.setLoadingCssClass=function(t){this.loadingCssClass=t},p.prototype.setUpdateScrollPosition=function(t){this.updateScrollPosition=t},p.prototype.stopPendingNavigate_=function(){this.pendingNavigate&&(this.pendingNavigate.cancel("Cancel pending navigation"),this.pendingNavigate=null)},p.prototype.syncScrollPositionSyncThenAsync_=function(){var t=this,e=l.window.history.state;if(e){var o=e.scrollTop,i=e.scrollLeft,r=function(){t.updateScrollPosition&&l.window.scrollTo(i,o)};return new a(function(t){return r()&n.nextTick(function(){return r()&t()})})}},p.prototype.updateHistory_=function(t,e,n,o){o?l.window.history.replaceState(n,t,e):l.window.history.pushState(n,t,e),l.document.title=t},p}(r);p.prototype.registerMetalComponent&&p.prototype.registerMetalComponent(p,"App"),this.senna.App=p}.call(this),function(){this.senna.dataAttributes={basePath:"data-senna-base-path",linkSelector:"data-senna-link-selector",loadingCssClass:"data-senna-loading-css-class",senna:"data-senna",dispatch:"data-senna-dispatch",surface:"data-senna-surface",updateScrollPosition:"data-senna-update-scroll-position"}}.call(this),function(){var e=this.senna.core,n=this.sennaNamed.Promise.CancellablePromise,o=function(){function o(){t.classCallCheck(this,o)}return o.addParametersToUrlQueryString=function(t,e){var n="";return e.names().forEach(function(t){e.getAll(t).forEach(function(e){n+=t+"="+encodeURIComponent(e)+"&"})}),n=n.slice(0,-1),n&&(t+=t.indexOf("?")>-1?"&":"?",t+=n),t},o.joinPaths=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;e>o;o++)n[o-1]=arguments[o];return"/"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),n=n.map(function(t){return"/"===t.charAt(0)?t.substring(1):t}),[t].concat(n).join("/").replace(/\/$/,"")},o.parseResponseHeaders=function(t){var e=[];if(!t)return e;for(var n=t.split("\r\n"),o=0;o<n.length;o++){var i=n[o].indexOf(": ");if(i>0){var r=n[o].substring(0,i),s=n[o].substring(i+2);e.push({name:r,value:s})}}return e},o.parseUrl=function(t){var e,n,o,i=t.indexOf("//");i>-1&&(t=t.substring(i+2));var r=t.indexOf("/");-1===r&&(t+="/",r=t.length-1),e=t.substring(0,r),n=t.substring(r);var s=n.indexOf("?");return s>-1?(o=n.substring(s,n.length),n=n.substring(0,s)):o="",[e,n,o]},o.request=function i(t,r,s,a,l,c,u){var i=new XMLHttpRequest,h=new n(function(t,e){i.onload=function(){return i.aborted?void i.onerror():void t(i)},i.onerror=function(){var t=new Error("Request error");t.request=i,e(t)}}).thenCatch(function(t){throw i.abort(),t}).thenAlways(function(){clearTimeout(p)});if(l&&(t=o.addParametersToUrlQueryString(t,l)),i.open(r,t,!u),a&&a.names().forEach(function(t){i.setRequestHeader(t,a.getAll(t).join(", "))}),i.send(e.isDef(s)?s:null),e.isDefAndNotNull(c))var p=setTimeout(function(){h.cancel("Request timeout")},c);return h},o}();this.senna.Ajax=o}.call(this),function(){var e=this.senna.Disposable,n=function(e){function n(){t.classCallCheck(this,n);var o=t.possibleConstructorReturn(this,e.call(this));return o.keys={},o.values={},o}return t.inherits(n,e),n.prototype.add=function(t,e){return this.keys[t.toLowerCase()]=t,this.values[t.toLowerCase()]=this.values[t.toLowerCase()]||[],this.values[t.toLowerCase()].push(e),this},n.prototype.clear=function(){return this.keys={},this.values={},this},n.prototype.contains=function(t){return t.toLowerCase()in this.values},n.prototype.disposeInternal=function(){this.values=null},n.prototype.get=function(t){var e=this.values[t.toLowerCase()];return e?e[0]:void 0},n.prototype.getAll=function(t){return this.values[t.toLowerCase()]},n.prototype.isEmpty=function(){return 0===this.size()},n.prototype.names=function(){var t=this;return Object.keys(this.values).map(function(e){return t.keys[e]})},n.prototype.remove=function(t){return delete this.keys[t.toLowerCase()],delete this.values[t.toLowerCase()],this},n.prototype.set=function(t,e){return this.keys[t.toLowerCase()]=t,this.values[t.toLowerCase()]=[e],this},n.prototype.size=function(){return this.names().length},n.prototype.toString=function(){return JSON.stringify(this.values)},n}(e);n.prototype.registerMetalComponent&&n.prototype.registerMetalComponent(n,"MultiMap"),this.senna.MultiMap=n}.call(this),function(){var e=this.senna.core,n=this.senna.Ajax,o=this.senna.MultiMap,i=this.senna.Promise,r=this.senna.globals,s=this.senna.Screen,a=function(s){function a(){t.classCallCheck(this,a);var e=t.possibleConstructorReturn(this,s.call(this));return e.cacheable=!0,e.httpHeaders={"X-PJAX":"true","X-Requested-With":"XMLHttpRequest"},e.httpMethod=a.GET,e.request=null,e.timeout=3e4,e}return t.inherits(a,s),a.prototype.beforeUpdateHistoryPath=function(t){var e=this.getRequestResponsePath();return e&&e!==t?e:t},a.prototype.beforeUpdateHistoryState=function(t){return t.senna&&t.form&&t.navigatePath===t.path?null:t},a.prototype.getHttpHeaders=function(){return this.httpHeaders},a.prototype.getHttpMethod=function(){return this.httpMethod},a.prototype.getRequestResponsePath=function(){var t=this.getRequest();if(t){var e=r.document.createElement("a");return e.href=t.responseURL,e.pathname+e.search+e.hash}return null},a.prototype.getRequest=function(){return this.request},a.prototype.getTimeout=function(){return this.timeout},a.prototype.load=function(t){var s=this,l=this.getCache();if(e.isDefAndNotNull(l))return i.resolve(l);var c=null,u=this.httpMethod;r.capturedFormElement&&(c=new FormData(r.capturedFormElement),u=a.POST);var h=new o;return Object.keys(this.httpHeaders).forEach(function(t){return h.add(t,s.httpHeaders[t])}),n.request(t,u,c,h,null,this.timeout).then(function(t){return s.setRequest(t),u===a.GET&&s.isCacheable()&&s.addCache(t.responseText),s.setRequest(t),t.responseText})},a.prototype.setHttpHeaders=function(t){this.httpHeaders=t},a.prototype.setHttpMethod=function(t){this.httpMethod=t.toLowerCase()},a.prototype.setRequest=function(t){this.request=t},a.prototype.setTimeout=function(t){this.timeout=t},a}(s);a.prototype.registerMetalComponent&&a.prototype.registerMetalComponent(a,"RequestScreen"),a.GET="get",a.POST="post",this.senna.RequestScreen=a}.call(this),function(){var e=this.senna.globals,n=this.senna.RequestScreen,o=this.senna.Surface,i=this.senna.dataAttributes,r=function(n){function r(){t.classCallCheck(this,r);var e=t.possibleConstructorReturn(this,n.call(this));return e.titleSelector="title",e}return t.inherits(r,n),r.prototype.activate=function(){n.prototype.activate.call(this),this.releaseVirtualDocument()},r.prototype.allocateVirtualDocumentForContent=function(t){this.virtualDocument||(this.virtualDocument=e.document.createElement("html")),this.virtualDocument.innerHTML=t},r.prototype.getSurfaceContent=function(t){var e=this.virtualDocument.querySelector("#"+t);if(e){var n=e.querySelector("#"+t+"-"+o.DEFAULT);return n?n.innerHTML:e.innerHTML}},r.prototype.getTitleSelector=function(){return this.titleSelector},r.prototype.load=function(t){var e=this;return n.prototype.load.call(this,t).then(function(t){e.allocateVirtualDocumentForContent(t),e.resolveTitleFromVirtualDocument(),e.maybeSetBodyIdInVirtualDocument()})},r.prototype.releaseVirtualDocument=function(){this.virtualDocument=null},r.prototype.resolveTitleFromVirtualDocument=function(){var t=this.virtualDocument.querySelector(this.titleSelector);t&&this.setTitle(t.innerHTML.trim())},r.prototype.setTitleSelector=function(t){this.titleSelector=t},r.prototype.maybeSetBodyIdInVirtualDocument=function(){var t=this.virtualDocument.querySelector("body["+i.surface+"]");t&&(t.id=e.document.body.id)},r}(n);r.prototype.registerMetalComponent&&r.prototype.registerMetalComponent(r,"HtmlScreen"),this.senna.HtmlScreen=r}.call(this),function(){var e=this.senna.core,n=this.senna.object,o=this.senna.Disposable,i=this.senna.dataAttributes,r=this.senna.globals,s=this.senna.App,a=this.senna.HtmlScreen,l=this.senna.Route,c=function(o){function c(){t.classCallCheck(this,c);var e=t.possibleConstructorReturn(this,o.call(this));return e.app=null,e.baseElement=null,e}return t.inherits(c,o),c.prototype.handle=function(){if(!e.isElement(this.baseElement))throw new Error("Senna data attribute handler base element not set or invalid, try setting a valid element that contains a `data-senna` attribute.");if(this.baseElement.hasAttribute(i.senna)){if(this.app)throw new Error("Senna app was already initialized.");this.app=new s,this.maybeAddRoutes_(),this.maybeAddSurfaces_(),this.maybeSetBasePath_(),this.maybeSetLinkSelector_(),this.maybeSetLoadingCssClass_(),this.maybeSetUpdateScrollPosition_(),this.maybeDispatch_()}},c.prototype.disposeInternal=function(){this.app&&this.app.dispose()},c.prototype.getApp=function(){return this.app},c.prototype.getBaseElement=function(){return this.baseElement},c.prototype.maybeAddRoutes_=function(){var t=this,e='link[rel="senna-route"]';this.querySelectorAllAsArray_(e).forEach(function(e){return t.maybeParseLinkRoute_(e)}),this.app.hasRoutes()||this.app.addRoutes(new l(/.*/,a))},c.prototype.maybeAddSurfaces_=function(){var t=this,e="["+i.surface+"]";this.querySelectorAllAsArray_(e).forEach(function(e){t.updateElementIdIfSpecialSurface_(e),t.app.addSurfaces(e.id)})},c.prototype.maybeDispatch_=function(){this.baseElement.hasAttribute(i.dispatch)&&this.app.dispatch()},c.prototype.maybeParseLinkRoute_=function(t){var e=new l(this.maybeParseLinkRoutePath_(t),this.maybeParseLinkRouteHandler_(t));this.app.addRoutes(e)},c.prototype.maybeParseLinkRouteHandler_=function(t){var o=t.getAttribute("type");return e.isDefAndNotNull(o)&&(o=n.getObjectByName(o)),o},c.prototype.maybeParseLinkRoutePath_=function(t){var n=t.getAttribute("href");return e.isDefAndNotNull(n)&&0===n.indexOf("regex:")&&(n=new RegExp(n.substring(6))),n},c.prototype.maybeSetBasePath_=function(){var t=this.baseElement.getAttribute(i.basePath);e.isDefAndNotNull(t)&&this.app.setBasePath(t)},c.prototype.maybeSetLinkSelector_=function(){var t=this.baseElement.getAttribute(i.linkSelector);e.isDefAndNotNull(t)&&this.app.setLinkSelector(t)},c.prototype.maybeSetLoadingCssClass_=function(){var t=this.baseElement.getAttribute(i.loadingCssClass);e.isDefAndNotNull(t)&&this.app.setLoadingCssClass(t)},c.prototype.maybeSetUpdateScrollPosition_=function(){var t=this.baseElement.getAttribute(i.updateScrollPosition);e.isDefAndNotNull(t)&&("false"===t?this.app.setUpdateScrollPosition(!1):this.app.setUpdateScrollPosition(!0))},c.prototype.querySelectorAllAsArray_=function(t){return Array.prototype.slice.call(r.document.querySelectorAll(t))},c.prototype.updateElementIdIfSpecialSurface_=function(t){t.id||t!==r.document.body||(t.id="senna_surface_"+e.getUid())},c.prototype.setBaseElement=function(t){this.baseElement=t},c}(o);c.prototype.registerMetalComponent&&c.prototype.registerMetalComponent(c,"AppDataAttributeHandler"),this.senna.AppDataAttributeHandler=c}.call(this),function(){var t=this.senna.globals,e=this.senna.AppDataAttributeHandler,n=new e;t.document.addEventListener("DOMContentLoaded",function(){n.setBaseElement(t.document.body),n.handle()}),this.senna.dataAttributeHandler=n}.call(this)}).call(this);